<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Marcador DaCapoWarts</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cinzel', serif;
      background: linear-gradient(to bottom, #0a0a3d, #2a1a5c);
      color: #f5e6c8;
      text-align: center;
      min-height: 100vh;
      background-image: url('Fons.png'); 
      background-size: cover;
      padding: 80px;
    }

    h1 {
      font-family: 'Cinzel', serif;
      text-shadow: 2px 2px 8px #000;
      font-size: 3.5em;
      margin-bottom: 60px;
    }
    
    h2 {
      font-family: 'Cinzel', serif;
      text-shadow: 2px 2px 8px #000;
      font-size: 2.5em;
      margin-top: 45px;
      margin-bottom: 20px;
    }
    
    span {
      font-size: 2.2em;
      font-weight: bold;
    }

    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 36px;
      border: 2px solid #f5e6c8;
      border-radius: 12px;
      background: linear-gradient(to top, #3a0c5a, #6a1fa5);
      color: #f5e6c8;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 12px #6a1fa5;
    }

    button:hover {
      transform: scale(1.1) rotate(-2deg);
      box-shadow: 0 0 18px #ffd700;
    }

    #history-log {
      max-height: 300px;
      overflow-y: auto;
      border: 2px solid #f5e6c8;
      padding: 10px;
      margin: 10px auto;
      width: 80%;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      font-family: 'Cinzel', serif;
    }

    .positive { color: #7CFC00; } /* verd màgic */
    .negative { color: #FF4500; } /* vermell foc */

    /* petits estils per l'input d'admin */
    #admin-area { margin-bottom: 30px; }
    #admin-pass { padding:8px; font-size:16px; }
    #set-key-btn { padding:8px 12px; font-size:16px; margin-left:8px;}
  </style>
</head>
<body>
  <h1>Marcador DaCapoWarts</h1>

  <!-- Àrea per introduir la contrasenya d'admin -->
  <div id="admin-area">
    <input id="admin-pass" type="password" placeholder="Introdueix la contrasenya d'admin">
    <button id="set-key-btn" onclick="setAdminKey()">Validar contrasenya</button>
    <p id="pass-info" style="color:lightgray; font-size:14px;">Introdueix la contrasenya si ets admin. La contrasenya no està al codi.</p>
  </div>

  <!-- Puntacions -->
  <h2>Ordre del Fènix: <span id="score-equip1">0</span> punts</h2>
  <div>
    <button onclick="updateScore('equip1', 5)">+5</button>
    <button onclick="updateScore('equip1', 10)">+10</button>
    <button onclick="updateScore('equip1', 15)">+15</button>
    <button onclick="updateScore('equip1', 20)">+20</button>
    <button onclick="updateScore('equip1', 30)">+30</button>
    <button onclick="updateScore('equip1', 50)">+50</button>
    <button onclick="updateScore('equip1', 70)">+70</button>
    <br>
    <button onclick="updateScore('equip1', -5)">-5</button>
    <button onclick="updateScore('equip1', -10)">-10</button>
    <button onclick="updateScore('equip1', -15)">-15</button>
    <button onclick="updateScore('equip1', -20)">-20</button>
    <button onclick="updateScore('equip1', -30)">-30</button>
    <button onclick="updateScore('equip1', -50)">-50</button>
    <button onclick="updateScore('equip1', -70)">-70</button>
  </div>

  <h2>Cavallers de la Mort: <span id="score-equip2">0</span> punts</h2>
  <div>
    <button onclick="updateScore('equip2', 5)">+5</button>
    <button onclick="updateScore('equip2', 10)">+10</button>
    <button onclick="updateScore('equip2', 15)">+15</button>
    <button onclick="updateScore('equip2', 20)">+20</button>
    <button onclick="updateScore('equip2', 30)">+30</button>
    <button onclick="updateScore('equip2', 50)">+50</button>
    <button onclick="updateScore('equip2', 70)">+70</button>
    <br>
    <button onclick="updateScore('equip2', -5)">-5</button>
    <button onclick="updateScore('equip2', -10)">-10</button>
    <button onclick="updateScore('equip2', -15)">-15</button>
    <button onclick="updateScore('equip2', -20)">-20</button>
    <button onclick="updateScore('equip2', -30)">-30</button>
    <button onclick="updateScore('equip2', -50)">-50</button>
    <button onclick="updateScore('equip2', -70)">-70</button>
  </div>

  <!-- Historial (opcional) -->
  <div id="history-log"></div>

  <!-- =================== Script Firebase =================== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCu8eXQUhD8vd-W8NfCfFurDkWxG0o5En8",
      authDomain: "marcador-dacapowarts-ffeca.firebaseapp.com",
      databaseURL: "https://marcador-dacapowarts-ffeca-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "marcador-dacapowarts-ffeca",
      storageBucket: "marcador-dacapowarts-ffeca.firebasestorage.app",
      messagingSenderId: "613762687721",
      appId: "1:613762687721:web:e3582bdc41f7befec8c678"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // **NO posar la contrasenya aquí**. La contrasenya es comprova a Firebase Rules.
    // L'usuari escriu la contrasenya al navegador; la guardem temporalment a adminKey.
    let adminKey = null;

    // Funció per establir la clau que l'admin introdueix (només queda al navegador)
    window.setAdminKey = function() {
      adminKey = document.getElementById('admin-pass').value || null;
      const info = document.getElementById('pass-info');
      if (adminKey) {
        info.textContent = "Clau introduïda localment. Les escriptures seran verificades pel servidor.";
      } else {
        info.textContent = "No hi ha cap clau. Les escriptures seran rebutjades.";
      }
    };

    // Funció per actualitzar marcador (sempre s'envia el camp 'secret' amb la clau local)
    window.updateScore = async function(team, delta) {
      try {
        const scoreRef = ref(db, 'scores/' + team);
        const snapshot = await get(scoreRef);
        const currentPoints = snapshot.exists() ? snapshot.val().points : 0;
        const newPoints = currentPoints + delta;

        // Enviem l'objecte amb el camp 'secret' que Firebase Rules comprovarà
        await set(scoreRef, {
          points: newPoints,
          secret: adminKey  // null si no hi ha clau; firesbase Rules el compararà
        });

        // Actualitzar UI local (si Firebase accepta la write, la UI serà actualitzada ara)
        document.getElementById(`score-${team}`).textContent = newPoints;
      } catch (err) {
        // Si Firebase rebutja l'escriptura apareix un error a la consola (opcional)
        console.error("Error al intentar actualitzar puntuació:", err);
        // També podries mostrar un missatge a l'usuari si ho desitges
      }
    };

    // Inicialitzar valors de marcador al carregar la pàgina
    window.addEventListener('load', async () => {
      const snapshot1 = await get(ref(db, 'scores/equip1'));
      const points1 = snapshot1.exists() ? snapshot1.val().points : 0;
      document.getElementById('score-equip1').textContent = points1;

      const snapshot2 = await get(ref(db, 'scores/equip2'));
      const points2 = snapshot2.exists() ? snapshot2.val().points : 0;
      document.getElementById('score-equip2').textContent = points2;

      // Si vols que la UI s'actualitzi en temps real quan un altre usuari canvia,
      // pots utilitzar onValue en comptes de get → exemple:
      onValue(ref(db, 'scores/equip1'), (snap) => {
        if (snap.exists()) document.getElementById('score-equip1').textContent = snap.val().points;
      });
      onValue(ref(db, 'scores/equip2'), (snap) => {
        if (snap.exists()) document.getElementById('score-equip2').textContent = snap.val().points;
      });
    });
  </script>
</body>
</html>

   

