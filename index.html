<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Marcador DaCapoWarts</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cinzel', serif;
      background: linear-gradient(to bottom, #0a0a3d, #2a1a5c); 
      color: #f5e6c8;
      text-align: center;
      min-height: 100vh;
      background-image: url('Fons3.png'); 
      background-size: cover;
      padding: 80px;
    }

    h1 {
      font-family: 'Cinzel', serif;
      text-shadow: 2px 2px 8px #000;
      font-size: 3.8em;
      margin-bottom: 60px;
    }
    
    h2 {
      font-family: 'Cinzel', serif;
      text-shadow: 2px 2px 8px #000;
      font-size: 3.2em;
      margin-top: 45px;
      margin-bottom: 20px;
    }
    
    span {
      font-size: 2em;      font-weight: bold;
    }
    /* ðŸŽ¯ COLOR NOMÃ‰S PER ALS NÃšMEROS DE PUNTUACIÃ“ */
    #score-equip1,
    #score-equip2 {
      color: #ffe97f; 
      text-shadow: 
        0 0 4px #d9b55c,
      0 0 8px rgba(255, 215, 0, 0.4); 
      font-weight: bold;
    }

    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 36px;
      border: 2px solid #f5e6c8;
      border-radius: 12px;
      background: linear-gradient(to top, #3a0c5a, #6a1fa5);
      color: #f5e6c8;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 8px #6a1fa5;
    }

    button:hover {
      transform: scale(1.1) rotate(-2deg);
      box-shadow: 0 0 18px #ffd700;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* 4 botons per fila */
      gap: 12px;
      max-width: 700px;
      margin: 0 auto 40px auto;
    }
  </style>
</head>

<body>
  <h1>Marcador DaCapoWarts</h1>

  <!-- =================== Equip 1 =================== -->
  <h2>Ordre del FÃ¨nix: <span id="score-equip1">0</span> punts</h2>
  <div class="button-grid">
    <button onclick="updateScore('equip1', 5)">+5</button>
    <button onclick="updateScore('equip1', 10)">+10</button>
    <button onclick="updateScore('equip1', 15)">+15</button>
    <button onclick="updateScore('equip1', 20)">+20</button>
    <button onclick="updateScore('equip1', 25)">+25</button>
    <button onclick="updateScore('equip1', 30)">+30</button>
    <button onclick="updateScore('equip1', 50)">+50</button>
    <button onclick="updateScore('equip1', 70)">+70</button>
  
    <button onclick="updateScore('equip1', -5)">-5</button>
    <button onclick="updateScore('equip1', -10)">-10</button>
    <button onclick="updateScore('equip1', -15)">-15</button>
    <button onclick="updateScore('equip1', -20)">-20</button>
    <button onclick="updateScore('equip1', -25)">-25</button>
    <button onclick="updateScore('equip1', -30)">-30</button>
    <button onclick="updateScore('equip1', -50)">-50</button>
    <button onclick="updateScore('equip1', -70)">-70</button>
  </div>

  

  <!-- =================== Equip 2 =================== -->
  <h2>Cavallers de la Mort: <span id="score-equip2">0</span> punts</h2>
  <div class="button-grid">
    <button onclick="updateScore('equip2', 5)">+5</button>
    <button onclick="updateScore('equip2', 10)">+10</button>
    <button onclick="updateScore('equip2', 15)">+15</button>
    <button onclick="updateScore('equip2', 20)">+20</button>
    <button onclick="updateScore('equip2', 25)">+25</button>
    <button onclick="updateScore('equip2', 30)">+30</button>
    <button onclick="updateScore('equip2', 50)">+50</button>
    <button onclick="updateScore('equip2', 70)">+70</button>

    <button onclick="updateScore('equip2', -5)">-5</button>
    <button onclick="updateScore('equip2', -10)">-10</button>
    <button onclick="updateScore('equip2', -15)">-15</button>
    <button onclick="updateScore('equip2', -20)">-20</button>
    <button onclick="updateScore('equip2', -25)">-25</button>
    <button onclick="updateScore('equip2', -30)">-30</button>
    <button onclick="updateScore('equip2', -50)">-50</button>
    <button onclick="updateScore('equip2', -70)">-70</button>
 </div>

<!-- =============== MODAL CONTRASENYA (ANTI-ZOOM) =============== -->
<div id="password-modal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  backdrop-filter: blur(4px);
  justify-content:center;
  align-items:center;
  padding:0.2em;">
  
  <div id="password-box" style="
    background:#2a1a5c;
    padding:1em;
    width:100%;
    max-width:600px;
    border:0.125em solid #f5e6c8;
    border-radius:0.9375em;
    text-align:center;
    box-shadow:0 0 1em #000;
    transition:0.3s;">
    
    <h2 id="password-title" style="
      margin-bottom:10px;
      font-size:2.5em;
      line-height:1.3;">
      NomÃ©s l'equip docent autoritzat pot modificar el marcador!<br>
      Introdueix la contrasenya
    </h2>
    
    <input id="password-input" type="password" style="
      padding:8px;
      width:100%;
      font-size:2.6em;
      border-radius:8px;
      border:2px solid #f5e6c8;
      background:#fff;">
      
    <br><br>
    
    <button onclick="submitPassword()" style="
      padding:8px 16px;
      font-size:2.5em;
      border-radius:10px;
      border:2px solid #f5e6c8;
      background: linear-gradient(to top, #3a0c5a, #6a1fa5);
      color:#f5e6c8;
      cursor:pointer;">
      Entrar
    </button>
  </div>
</div>




<!-- =================== SCRIPT FIREBASE =================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
  import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCu8eXQUhD8vd-W8NfCfFurDkWxG0o5En8",
    authDomain: "marcador-dacapowarts-ffeca.firebaseapp.com",
    databaseURL: "https://marcador-dacapowarts-ffeca-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "marcador-dacapowarts-ffeca",
    storageBucket: "marcador-dacapowarts-ffeca.firebasestorage.app",
    messagingSenderId: "613762687721",
    appId: "1:613762687721:web:e3582bdc41f7befec8c678"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  /* ================= CONTRASENYA ================= */
  let userSecret = null;
  let pendingAction = null;

  function requestPassword(action) {
    pendingAction = action;
    document.getElementById("password-modal").style.display = "flex";
    document.getElementById("password-input").value = "";
    document.getElementById("password-input").focus();
  }

  window.submitPassword = function () {
    const pwd = document.getElementById("password-input").value.trim();
    if (!pwd) {
      document.getElementById("password-modal").style.display = "none";
      return;
    }

    userSecret = pwd;
    document.getElementById("password-modal").style.display = "none";
    
       // === Restablir zoom al tancar la finestra de contrasenya ===
    setTimeout(() => {
        // Scroll a la posiciÃ³ 0 per evitar que el mÃ²bil quedi desplaÃ§at
        window.scrollTo(0, 0);

        // Alguns navegadors interpreten aquest "reflow" com un reset del zoom
        document.body.style.transform = "scale(1)";
        document.body.style.transformOrigin = "0 0";

        // Alternativa: reassignar la meta viewport (Safari i Chrome)
        const viewport = document.querySelector("meta[name=viewport]");
        if (viewport) {
            viewport.setAttribute("content", "width=device-width, initial-scale=1.0");
        }
    }, 100); // petit delay per deixar que el modal desaparegui

    if (pendingAction) {
      pendingAction();
      pendingAction = null;
    }
  };

  /* ================= ACTUALITZAR MARCADOR ================= */
  window.updateScore = async function(team, delta) {
    if (!userSecret) {
      return requestPassword(() => updateScore(team, delta));
    }

    const scoreRef = ref(db, "scores/" + team);
    const snapshot = await get(scoreRef);
    const currentPoints = snapshot.exists() ? snapshot.val().points : 0;
    const newPoints = currentPoints + delta;

    try {
      await set(scoreRef, {
        points: newPoints,
        secret: userSecret
      });
    } catch (err) {
      alert("âš ï¸ Contrasenya incorrecta.");
      userSecret = null;
      return ;
    }

    document.getElementById(`score-${team}`).textContent = newPoints;
  };

  /* ================= CARREGAR PUNTS ================= */
  window.addEventListener('load', async () => {
    const snap1 = await get(ref(db, 'scores/equip1'));
    document.getElementById('score-equip1').textContent =
      snap1.exists() ? snap1.val().points : 0;

    const snap2 = await get(ref(db, 'scores/equip2'));
    document.getElementById('score-equip2').textContent =
      snap2.exists() ? snap2.val().points : 0;
  });
</script>

</body>
</html>
